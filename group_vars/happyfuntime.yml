---
ansible_become: true
umn_user_management_directory_users:
  - name: "mcfa0086"
    revoke: no
    sudo: yes
    authorized_keys: 
      - 'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAyEflucZ6zQruAmA5I2CBTE8H6jkMsmg2giLcJ6Hb5zQvBYbqGaawXiLaPfPm8lotlTLf0XR8Q7J39qFYP3diwzYSj9IlG1NSE1nDOvbitMQFn9s08Ei9zi4TJb2rR/tmLYZLlyPsJgoJpEis2nl+IVjJ+uyu99B/94IEsudB7+YIcu11BWlpb5kuVXNkF4XLojoKHsBn9Aeb5DCvOFtzXAgWCAvsbe0b5kOnvu84EBB1wxMmNx6LPe+kd/NrwVEorgQSSX1g/raYVANALCqgVmS3kKF6iVuCBpdfPFwo8djEJPzj7V3QI0Rc2/l6AZ7xCtCU4JCsZGByDiCJ5JRQfQ== mcfa0086@umn.edu'
umn_user_management_deploy_users:
  - name: "latis_deploy"
    uid: 30000
    comment: "LATIS Deploy User"
    primary_group: "latis_deploy"
    shell: /bin/bash
    create_home: yes
    groups: []
    authorized_keys_from_directory_users: yes


laravel_app_key: "{{ lookup('umn_community.umn_rhel9_management.azure_keyvault', 'happyfuntime-secret') }}"

laravel_env_additions:
  - "APP_KEY={{ laravel_app_key }}"
  - "DB_CONNECTION=sqlite"
  - "DB_DATABASE=database.sqlite"



nginx_vhosts:
  - listen: "80"
    server_name: "{{ hostname }}"
    return: "301 https://{{hostname}}$request_uri"
    filename: "{{hostname}}.80.conf"
  - listen: "443 ssl http2"
    server_name: "{{ hostname }}"
    root: "/var/www/html/current/public/"
    index: "index.php index.html index.htm"
    state: "present"
    # realpath param in nginx config is necessary so that it reloads files when symlink is updated
    extra_parameters: |
      location ~ \.php$ {
          fastcgi_split_path_info ^(.+\.php)(/.+)$;
          fastcgi_pass 127.0.0.1:9000;
          fastcgi_index index.php;
          fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
          include fastcgi_params;
      }
      ssl_certificate     /etc/letsencrypt/live/{{hostname}}/cert.pem;
      ssl_certificate_key /etc/letsencrypt/live/{{hostname}}/privkey.pem;
      ssl_protocols       TLSv1.1 TLSv1.2;
      ssl_ciphers         HIGH:!aNULL:!MD5;

php_version: '83'
php_packages:
  - php{{php_version}}
  - php{{php_version}}-php-cli
  - php{{php_version}}-php-common
  - php{{php_version}}-php-devel
  - php{{php_version}}-php-mysqlnd
  - php{{php_version}}-php-opcache
  - php{{php_version}}-php-pecl-apcu
  - php{{php_version}}-syspaths
php_enablerepo: "remi"
php_webserver_daemon: "nginx"
php_enable_php_fpm: true
php_fpm_pool_user: "nginx"
php_fpm_pool_group: "nginx"
php_fpm_daemon: "php83-php-fpm"
php_conf_paths: 
  - "/etc/opt/remi/php83"
php_extension_conf_paths: 
  - "/etc/opt/remi/php83/php.d"
php_fpm_pool_conf_path: "/etc/opt/remi/php83/php-fpm.d/www.conf"
certbot_auto_renew: true
certbot_create_if_missing: true
certbot_create_method: standalone
certbot_admin_email: latistecharch@umn.edu
certbot_certs:
  - domains:
    - "{{ hostname }}"
certbot_create_standalone_stop_services: []
nodejs_npm_global_packages:
  - name: jslint
  - name: node-sass
nginx_remove_default_vhost: false